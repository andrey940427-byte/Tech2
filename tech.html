<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£—á–∏—Ç–µ–ª—å—Å–∫–∏–π –ö–∞–ª–µ–Ω–¥–∞—Ä—å –†–ë 2025-2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —à—Ä–∏—Ñ—Ç–∞ Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
        }
        .day-cell {
            padding: 4px 2px;
            font-size: 0.75rem; /* text-xs */
            height: 48px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 6px;
            cursor: pointer;
            position: relative; /* –î–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–º–µ—Ç–∫–∏ */
            transition: background-color 0.15s, border-color 0.15s;
        }
        .day-number {
            font-weight: 600;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –≤—Å–ø–ª—ã–≤–∞—é—â–µ–π –ø–æ–¥—Å–∫–∞–∑–∫–∏ */
        .tooltip-content {
            white-space: normal; 
            max-width: 200px; 
            text-align: left;
        }

        /* –¶–≤–µ—Ç–æ–≤–∞—è –ª–µ–≥–µ–Ω–¥–∞ –∏ —Å—Ç–∏–ª–∏ */
        .weekend { background-color: #fecaca; color: #dc2626; } /* –°–≤–µ—Ç–ª–æ-–ö—Ä–∞—Å–Ω—ã–π (–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –í—ã—Ö–æ–¥–Ω–æ–π –°–±/–í—Å) */
        
        /* –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–∞–∑–¥–Ω–∏–∫ (–í—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ —Ü–≤–µ—Ç—É) */
        .official-holiday { background-color: #ff8a8a; color: #7f1d1d; font-weight: 700; border: 2px solid #ef4444; } 
        
        /* –ü–µ—Ä–µ–Ω–æ—Å—ã */
        .transfer-day-off { background-color: #6ee7b7; color: #065f46; font-weight: 700; border: 1px solid #10b981; } 
        .transfer-workday { background-color: #bfdbfe; color: #1d4ed8; border: 1px dashed #3b82f6; font-weight: 700; } 
        
        /* –ö–æ–Ω–∫—É—Ä—Å—ã/–û–ª–∏–º–ø–∏–∞–¥—ã */
        .competition { background-color: #fef08a; color: #a16207; border: 1px solid #eab308; } 
        
        /* –ö–∞–Ω–∏–∫—É–ª—ã (–ë–∞–∑–æ–≤—ã–π —Å—Ç–∏–ª—å –¥–ª—è —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π) */
        .school-holiday { background-color: #ffffff; color: #6d28d9; border: 1px solid #8b5cf6; } 
        
        .exam { background-color: #ccfbf1; color: #0f766e; border: 1px solid #14b8a6; font-weight: 700; } 
        
        .today { background-color: #fee2e2 !important; border: 2px solid #ef4444 !important; color: #ef4444 !important; } 

        .current-month { background-color: #ffffff; }
        .other-month { background-color: #e5e7eb; color: #6b7280; }

        /* !!! –ö–õ–Æ–ß–ï–í–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï !!! –ö–ª–∞—Å—Å –¥–ª—è –Ω–∞–ª–æ–∂–µ–Ω–∏—è –ø—É—Ä–ø—É—Ä–Ω–æ–π —Ä–∞–º–∫–∏ –∫–∞–Ω–∏–∫—É–ª –Ω–∞ —É–∂–µ –∑–∞–∫—Ä–∞—à–µ–Ω–Ω—ã–π —Ñ–æ–Ω */
        /* –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –¥–Ω—è–º, –∫–æ—Ç–æ—Ä—ã–µ —è–≤–ª—è—é—Ç—Å—è –∫–∞–Ω–∏–∫—É–ª–∞–º–∏, –Ω–æ —Ç–∞–∫–∂–µ —è–≤–ª—è—é—Ç—Å—è –≤—ã—Ö–æ–¥–Ω—ã–º–∏/–ø—Ä–∞–∑–¥–Ω–∏–∫–∞–º–∏ */
        .holiday-overlay {
            color: #6d28d9 !important; /* –ü—É—Ä–ø—É—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç */
            border: 1px solid #8b5cf6 !important; /* –ü—É—Ä–ø—É—Ä–Ω–∞—è —Ä–∞–º–∫–∞ */
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–º–µ—Ç–∫–∏ */
        .note-indicator {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.7rem;
            font-weight: 900;
        }
    </style>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤ —Å–∫—Ä–∏–ø—Ç–µ –Ω–∏–∂–µ
        window.firebase = { 
            initializeApp, 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            onAuthStateChanged,
            getFirestore, 
            doc, 
            addDoc, 
            updateDoc, 
            deleteDoc, 
            onSnapshot, 
            collection,
            setLogLevel
        };
    </script>
</head>
<body>

    <div class="max-w-6xl mx-auto p-4 sm:p-6 lg:p-8">
        <h1 class="text-3xl font-extrabold text-center text-gray-900 mb-2">–ö–∞–ª–µ–Ω–¥–∞—Ä—å –£—á–∏—Ç–µ–ª—è</h1>
        <p class="text-center text-lg text-gray-600 mb-8">–£—á–µ–±–Ω—ã–π –≥–æ–¥ 2025 ‚Äì 2026 (–°–µ–Ω—Ç—è–±—Ä—å 2025 - –ê–≤–≥—É—Å—Ç 2026, –†–µ—Å–ø—É–±–ª–∏–∫–∞ –ë–µ–ª–∞—Ä—É—Å—å)</p>

        <div class="flex flex-wrap justify-center gap-3 mb-8 text-xs font-semibold">
            <span class="flex items-center"><span class="w-4 h-4 rounded-full mr-1 bg-fecaca"></span> ‚Äî –í—ã—Ö–æ–¥–Ω–æ–π (–°–±/–í—Å)</span>
            <span class="flex items-center"><span class="w-4 h-4 rounded-full mr-1 bg-ff8a8a border border-2 border-red-600"></span> ‚Äî **–ö—Ä–∞—Å–Ω—ã–π –¥–µ–Ω—å (–ü—Ä–∞–∑–¥–Ω–∏–∫)**</span>
            <span class="flex items-center"><span class="w-4 h-4 rounded-full mr-1 bg-white border border-1 border-violet-500"></span> ‚Äî **–ö–∞–Ω–∏–∫—É–ª—ã (\*)**</span>
            <span class="flex items-center"><span class="w-4 h-4 rounded-full mr-1 bg-ccfbf1 border border-1 border-teal-500"></span> ‚Äî **–¶–≠**</span>
            <span class="flex items-center"><span class="w-4 h-4 rounded-full mr-1 bg-6ee7b7 border border-1 border-emerald-600"></span> ‚Äî **–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—ã–π –í—ã—Ö**</span>
            <span class="flex items-center"><span class="w-4 h-4 rounded-full mr-1 bg-bfdbfe border border-1 border-blue-600"></span> ‚Äî **–†–∞–±–æ—á–∞—è –°–± (–ü–µ—Ä–µ–Ω–æ—Å)**</span>
            <span class="flex items-center"><span class="w-4 h-4 rounded-full mr-1 bg-fef08a border border-1 border-yellow-600"></span> ‚Äî **–û–ª–∏–º–ø/–ù–ü–ö**</span>
            <span class="flex items-center text-indigo-600"># ‚Äî –í–∞—à–∞ –∑–∞–º–µ—Ç–∫–∞</span>
        </div>

        <div id="calendarContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            </div>
    </div>

    <div id="noteModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-[100]">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6">
            <h3 id="modalTitle" class="text-xl font-bold text-gray-800 mb-4">–ó–∞–º–µ—Ç–∫–∞ –Ω–∞ [–î–∞—Ç–∞]</h3>
            <textarea id="noteInput" class="w-full h-32 p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 mb-4" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É –∑–∞–º–µ—Ç–∫—É..." maxlength="500"></textarea>
            
            <div class="flex justify-between items-center">
                <button id="deleteNoteBtn" onclick="handleDeleteNote()" class="hidden bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                    –£–¥–∞–ª–∏—Ç—å
                </button>
                <div class="flex space-x-2">
                    <button onclick="closeNoteModal()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition-colors">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button onclick="handleSaveNote()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
            <input type="hidden" id="currentDateKey">
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö Firebase
        let app, db, auth;
        let userId = null;
        let isAuthReady = false;
        const NOTES_COLLECTION = "notes";
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Canvas. 
        // –í–ê–ñ–ù–û: –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ –Ω–∞ GitHub Pages –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ, –µ—Å–ª–∏ —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã,
        // Firebase –º–æ–∂–µ—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è.
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'teacher-calendar-rb'; 
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // !!! –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø: –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–û –ù–ê –°–í–û–ò –ö–õ–Æ–ß–ò FIREBASE –ò–õ–ò –û–°–¢–ê–í–¨–¢–ï –ü–£–°–¢–´–ú,
        // –ß–¢–û–ë–´ –£–í–ò–î–ï–¢–¨ –ö–ê–õ–ï–ù–î–ê–†–¨, –ù–û –ë–ï–ó –ó–ê–ú–ï–¢–û–ö.
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∑–∞–º–µ—Ç–æ–∫, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑ Firestore: { "YYYY-MM-DD": { id: "docId", content: "—Ç–µ–∫—Å—Ç" } }
        let userNotes = {};

        // –î–∞—Ç–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è
        const TODAY_DATE_KEY = new Date().toLocaleDateString('en-CA', { year: 'numeric', month: '2-digit', day: '2-digit' });
        
        // --- –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ì–ï–ù–ï–†–ê–¶–ò–ò –î–ê–¢ –ö–ê–ù–ò–ö–£–õ –ò –î–õ–ò–¢–ï–õ–¨–ù–´–• –°–û–ë–´–¢–ò–ô ---
        function generateDateRange(start, end, name, type) {
            const events = {};
            // –î–æ–±–∞–≤–ª—è–µ–º 'T00:00:00' –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–∞—Ö
            let current = new Date(start + 'T00:00:00'); 
            const endDate = new Date(end + 'T00:00:00');

            while (current <= endDate) {
                const year = current.getFullYear();
                const month = String(current.getMonth() + 1).padStart(2, '0');
                const day = String(current.getDate()).padStart(2, '0');
                const dateKey = `${year}-${month}-${day}`;
                events[dateKey] = { name, type };
                current.setDate(current.getDate() + 1);
            }
            return events;
        }

        // --- –î–ê–¢–´ –®–ö–û–õ–¨–ù–´–• –ö–ê–ù–ò–ö–£–õ (–¢–æ–ª—å–∫–æ –¥–ª—è 3-11 –∫–ª–∞—Å—Å–æ–≤) ---
        const SCHOOL_HOLIDAYS = {
            // –û—Å–µ–Ω–Ω–∏–µ –∫–∞–Ω–∏–∫—É–ª—ã: 2 –Ω–æ—è–±—Ä—è ‚Äì 9 –Ω–æ—è–±—Ä—è 2025 –≥.
            ...generateDateRange('2025-11-02', '2025-11-09', '–û—Å–µ–Ω–Ω–∏–µ –∫–∞–Ω–∏–∫—É–ª—ã (3-11 –∫–ª.)', 'school-holiday'),

            // –ó–∏–º–Ω–∏–µ –∫–∞–Ω–∏–∫—É–ª—ã: 25 –¥–µ–∫–∞–±—Ä—è 2025 –≥. ‚Äì 7 —è–Ω–≤–∞—Ä—è 2026 –≥.
            ...generateDateRange('2025-12-25', '2026-01-07', '–ó–∏–º–Ω–∏–µ –∫–∞–Ω–∏–∫—É–ª—ã (3-11 –∫–ª.)', 'school-holiday'),

            // –í–µ—Å–µ–Ω–Ω–∏–µ –∫–∞–Ω–∏–∫—É–ª—ã: 22 –º–∞—Ä—Ç–∞ ‚Äì 29 –º–∞—Ä—Ç–∞ 2026 –≥.
            ...generateDateRange('2026-03-22', '2026-03-29', '–í–µ—Å–µ–Ω–Ω–∏–µ –∫–∞–Ω–∏–∫—É–ª—ã (3-11 –∫–ª.)', 'school-holiday'),
        };

        // --- –î–ê–¢–´ –¶–≠ (–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —ç–∫–∑–∞–º–µ–Ω - 11 –∫–ª–∞—Å—Å) ---
        const EXAMS = {
            "2026-05-26": { name: "–¶–≠: –ü—Ä–µ–¥–º–µ—Ç –Ω–∞ –≤—ã–±–æ—Ä (2-–π —ç–∫–∑–∞–º–µ–Ω)", type: "exam" },
            "2026-05-29": { name: "–¶–≠: –†—É—Å—Å–∫–∏–π –∏–ª–∏ –ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ (1-–π —ç–∫–∑–∞–º–µ–Ω)", type: "exam" },
            "2026-06-20": { name: "–¶–≠: –†–µ–∑–µ—Ä–≤–Ω—ã–π –¥–µ–Ω—å (–ü—Ä–µ–¥–º–µ—Ç –Ω–∞ –≤—ã–±–æ—Ä)", type: "exam" },
            "2026-06-22": { name: "–¶–≠: –†–µ–∑–µ—Ä–≤–Ω—ã–π –¥–µ–Ω—å (–Ø–∑—ã–∫–∏)", type: "exam" },
            "2026-08-17": { name: "–¶–≠: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –¥–µ–Ω—å", type: "exam" },
            "2026-08-19": { name: "–¶–≠: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –¥–µ–Ω—å", type: "exam" },
        };

        // --- –î–ê–ù–ù–´–ï –û –ú–ï–†–û–ü–†–ò–Ø–¢–ò–Ø–• (–†–ë) - –ò–º–µ—é—Ç –ü–†–ò–û–†–ò–¢–ï–¢ –Ω–∞–¥ –∫–∞–Ω–∏–∫—É–ª–∞–º–∏ –ø—Ä–∏ –Ω–∞–ª–æ–∂–µ–Ω–∏–∏ ---
        const EVENTS_BASE = {
            // –°–ï–ù–¢–Ø–ë–†–¨ 2025
            "2025-09-17": { name: "–î–µ–Ω—å –Ω–∞—Ä–æ–¥–Ω–æ–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–∞", type: "official-holiday" },
            
            // –û–ö–¢–Ø–ë–†–¨ 2025
            ...generateDateRange('2025-10-01', '2025-10-18', '–®–∫–æ–ª—å–Ω—ã–π —ç—Ç–∞–ø –æ–ª–∏–º–ø–∏–∞–¥ (1-–π —ç—Ç–∞–ø)', 'competition'),
            "2025-10-05": { name: "–î–µ–Ω—å –£—á–∏—Ç–µ–ª—è (–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)", type: "official-holiday" }, 

            // –ù–û–Ø–ë–†–¨ 2025
            "2025-11-07": { name: "–î–µ–Ω—å –û–∫—Ç—è–±—Ä—å—Å–∫–æ–π —Ä–µ–≤–æ–ª—é—Ü–∏–∏", type: "official-holiday" }, 
            "2025-11-14": { name: "–†–∞–π–æ–Ω–Ω—ã–π —ç—Ç–∞–ø –æ–ª–∏–º–ø–∏–∞–¥ (–ù–∞—á–∞–ª–æ)", type: "competition" },
            "2025-11-22": { name: "–ù–ü–ö (–ù–∞—É—á–Ω–æ-–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è), 1-–π —ç—Ç–∞–ø (–°—É–±–±–æ—Ç–∞)", type: "competition" },


            // –î–ï–ö–ê–ë–†–¨ 2025 (–ü–ï–†–ï–ù–û–°–´)
            "2025-12-20": { name: "–†–∞–±–æ—á–∞—è —Å—É–±–±–æ—Ç–∞ (–∑–∞ 26.12)", type: "transfer-workday" },
            "2025-12-25": { name: "–ö–∞—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ –†–æ–∂–¥–µ—Å—Ç–≤–æ", type: "official-holiday" }, 
            "2025-12-26": { name: "–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—ã–π –í—ã—Ö–æ–¥–Ω–æ–π (–∑–∞ 20.12)", type: "transfer-day-off" }, 

            // –Ø–ù–í–ê–†–¨ 2026
            "2026-01-01": { name: "–ù–æ–≤—ã–π –≥–æ–¥", type: "official-holiday" },
            "2026-01-02": { name: "–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—ã–π –í—ã—Ö–æ–¥–Ω–æ–π (–æ—Ç—Ä–∞–±–æ—Ç–∫–∞ 10.01)", type: "transfer-day-off" }, // –û–±–Ω–æ–≤–ª–µ–Ω–æ
            "2026-01-07": { name: "–ü—Ä–∞–≤–æ—Å–ª–∞–≤–Ω–æ–µ –†–æ–∂–¥–µ—Å—Ç–≤–æ", type: "official-holiday" },
            "2026-01-10": { name: "–†–∞–±–æ—á–∞—è —Å—É–±–±–æ—Ç–∞ (–æ—Ç—Ä–∞–±–æ—Ç–∫–∞ 02.01)", type: "transfer-workday" }, // –î–û–ë–ê–í–õ–ï–ù–û
            "2026-01-12": { name: "–û–±–ª–∞—Å—Ç–Ω–æ–π —ç—Ç–∞–ø –æ–ª–∏–º–ø–∏–∞–¥ (–ù–∞—á–∞–ª–æ)", type: "competition" },

            // –§–ï–í–†–ê–õ–¨ 2026
            "2026-02-23": { name: "–î–µ–Ω—å –∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤ –û—Ç–µ—á–µ—Å—Ç–≤–∞", type: "official-holiday" },

            // –ú–ê–†–¢ 2026
            "2026-03-08": { name: "–î–µ–Ω—å –∂–µ–Ω—â–∏–Ω", type: "official-holiday" },
            "2026-03-23": { name: "–ó–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã–π —ç—Ç–∞–ø –æ–ª–∏–º–ø–∏–∞–¥ (–ù–∞—á–∞–ª–æ)", type: "competition" },

            // –ê–ü–†–ï–õ–¨ 2026 (–ü–ï–†–ï–ù–û–°–´)
            "2026-04-20": { name: "–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—ã–π –í—ã—Ö–æ–¥–Ω–æ–π (–∑–∞ 25.04)", type: "transfer-day-off" },
            "2026-04-21": { name: "–†–∞–¥—É–Ω–∏—Ü–∞", type: "official-holiday" },
            "2026-04-25": { name: "–†–∞–±–æ—á–∞—è —Å—É–±–±–æ—Ç–∞ (–∑–∞ 20.04)", type: "transfer-workday" },

            // –ú–ê–ô 2026
            "2026-05-01": { name: "–ü—Ä–∞–∑–¥–Ω–∏–∫ —Ç—Ä—É–¥–∞", type: "official-holiday" },
            "2026-05-09": { name: "–î–µ–Ω—å –ü–æ–±–µ–¥—ã", type: "official-holiday" },

            // –ò–Æ–ù–¨ 2026
            "2026-07-03": { name: "–î–µ–Ω—å –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –†–ë", type: "official-holiday" },
        };
        
        // –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —Å–æ–±—ã—Ç–∏—è. EVENTS_BASE –∏ EXAMS –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç SCHOOL_HOLIDAYS –ø—Ä–∏ –∫–æ–ª–ª–∏–∑–∏–∏.
        const EVENTS = { ...SCHOOL_HOLIDAYS, ...EXAMS, ...EVENTS_BASE };

        const MONTH_NAMES = ["–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å", "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"];
        const WEEK_DAYS = ["–ü–Ω", "–í—Ç", "–°—Ä", "–ß—Ç", "–ü—Ç", "–°–±", "–í—Å"];

        // –ù–∞—á–∞–ª—å–Ω–∞—è –∏ –∫–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ —É—á–µ–±–Ω–æ–≥–æ –≥–æ–¥–∞
        const START_DATE = new Date(2025, 8, 1); 
        const END_DATE = new Date(2026, 7, 31);   

        // --- –§–£–ù–ö–¶–ò–ò FIREBASE ---

        async function initializeFirebase() {
            // –ï—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é, —á—Ç–æ–±—ã –Ω–µ –≤—ã–∑—ã–≤–∞—Ç—å –æ—à–∏–±–æ–∫
            if (!window.firebase || !firebaseConfig.apiKey) {
                console.warn("Firebase config not available. Notes functionality disabled.");
                return;
            }
            
            try {
                // window.firebase.setLogLevel('Debug'); // –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã –∫–æ–Ω—Å–æ–ª–∏

                app = window.firebase.initializeApp(firebaseConfig);
                db = window.firebase.getFirestore(app);
                auth = window.firebase.getAuth(app);
                
                if (initialAuthToken) {
                    await window.firebase.signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await window.firebase.signInAnonymously(auth);
                }
                
                window.firebase.onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        isAuthReady = true;
                        startListeningForNotes();
                    } else {
                        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ ID, –µ—Å–ª–∏ –∞–Ω–æ–Ω–∏–º–Ω—ã–π –≤—Ö–æ–¥ –Ω–µ —É–¥–∞–ª—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑-–∑–∞ –ø—Ä–∞–≤–∏–ª –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
                        userId = 'anon-' + (crypto.randomUUID ? crypto.randomUUID() : Math.random().toString(36).substring(2, 15)); 
                        isAuthReady = true;
                        startListeningForNotes();
                    }
                });
                
            } catch (error) {
                console.error("Error initializing Firebase:", error);
            }
        }

        function startListeningForNotes() {
            if (!db || !userId) {
                console.warn("Database or User ID not ready for listening.");
                return;
            }
            
            // –í–∞–∂–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: —Å–ª—É—à–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–º–µ—Ç–∫–∏ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç renderCalendar()
            const notesRef = window.firebase.collection(db, `artifacts/${appId}/users/${userId}/${NOTES_COLLECTION}`);
            
            window.firebase.onSnapshot(notesRef, (snapshot) => {
                const notes = {};
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    if (data.dateKey && data.content) {
                        notes[data.dateKey] = { id: doc.id, content: data.content };
                    }
                });
                userNotes = notes;
                renderCalendar(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Å —É—á–µ—Ç–æ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∑–∞–º–µ—Ç–æ–∫
            }, (error) => {
                console.error("Error listening to notes:", error);
            });
        }

        async function saveNote(dateKey, content, docId) {
            if (!db || !userId) {
                alert("–§—É–Ω–∫—Ü–∏—è –∑–∞–º–µ—Ç–æ–∫ –æ—Ç–∫–ª—é—á–µ–Ω–∞. –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.");
                return;
            }
            
            const noteData = { dateKey, content: content.trim() };
            const userPath = `artifacts/${appId}/users/${userId}/${NOTES_COLLECTION}`;

            try {
                if (docId) {
                    const docRef = window.firebase.doc(db, userPath, docId);
                    await window.firebase.updateDoc(docRef, noteData);
                } else {
                    await window.firebase.addDoc(window.firebase.collection(db, userPath), noteData);
                }
            } catch (e) {
                console.error("Error adding/updating document: ", e);
            }
        }

        async function deleteNote(docId) {
            if (!db || !userId || !docId) {
                console.error("Cannot delete note. Missing ID or Firebase not ready.");
                return;
            }
            
            const userPath = `artifacts/${appId}/users/${userId}/${NOTES_COLLECTION}`;
            
            try {
                await window.firebase.deleteDoc(window.firebase.doc(db, userPath, docId));
                closeNoteModal();
            } catch (e) {
                console.error("Error deleting document: ", e);
            }
        }
        
        // --- –§–£–ù–ö–¶–ò–ò –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê ---

        function openNoteModal(dateKey) {
            const date = new Date(dateKey + 'T00:00:00'); 
            const dateStr = date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });
            
            const note = userNotes[dateKey];
            
            document.getElementById('modalTitle').textContent = `–ó–∞–º–µ—Ç–∫–∞ –Ω–∞ ${dateStr}`;
            document.getElementById('currentDateKey').value = dateKey;
            
            const noteInput = document.getElementById('noteInput');
            const deleteBtn = document.getElementById('deleteNoteBtn');

            if (note) {
                noteInput.value = note.content;
                noteInput.dataset.docId = note.id;
                deleteBtn.classList.remove('hidden');
            } else {
                noteInput.value = '';
                noteInput.dataset.docId = '';
                deleteBtn.classList.add('hidden');
            }
            
            document.getElementById('noteModal').classList.remove('hidden');
            noteInput.focus();
        }

        function closeNoteModal() {
            document.getElementById('noteModal').classList.add('hidden');
        }
        
        async function handleSaveNote() {
            const dateKey = document.getElementById('currentDateKey').value;
            const content = document.getElementById('noteInput').value;
            const docId = document.getElementById('noteInput').dataset.docId;

            if (content.trim() === '') {
                if (docId) {
                    await deleteNote(docId);
                }
                closeNoteModal();
                return;
            }
            
            await saveNote(dateKey, content, docId || null);
            closeNoteModal();
        }

        function handleDeleteNote() {
            const docId = document.getElementById('noteInput').dataset.docId;
            if (docId && confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–º–µ—Ç–∫—É?')) {
                deleteNote(docId);
            }
        }


        // --- –§–£–ù–ö–¶–ò–ò –†–ï–ù–î–ï–†–ò–ù–ì–ê –ö–ê–õ–ï–ù–î–ê–†–Ø ---
        
        function generateMonthBlock(date) {
            const year = date.getFullYear();
            const month = date.getMonth(); 
            
            const firstDayOfMonth = new Date(year, month, 1);
            const firstWeekday = (firstDayOfMonth.getDay() === 0) ? 7 : firstDayOfMonth.getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            let calendarHtml = `
                <h2 class="text-lg font-bold text-center py-3 bg-indigo-600 text-white">${MONTH_NAMES[month]} ${year}</h2>
                <div class="calendar-grid bg-gray-200">
                    ${WEEK_DAYS.map(day => `<div class="text-center py-2 text-sm font-semibold text-gray-700">${day}</div>`).join('')}
                </div>
                <div class="calendar-grid bg-gray-100">
            `;
            
            let monthEventsList = [];

            // 1. –ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–ª—è —Å–¥–≤–∏–≥–∞
            for (let i = 0; i < firstWeekday - 1; i++) {
                calendarHtml += `<div class="day-cell other-month"></div>`;
            }

            // 2. –î–Ω–∏ –º–µ—Å—è—Ü–∞
            for (let day = 1; day <= daysInMonth; day++) {
                const dayString = String(day).padStart(2, '0');
                const monthString = String(month + 1).padStart(2, '0');
                const dateKey = `${year}-${monthString}-${dayString}`;
                
                const currentDate = new Date(year, month, day);
                const dayOfWeek = currentDate.getDay(); // 0=–í—Å, 1=–ü–Ω
                
                const isWeekend = (dayOfWeek === 0 || dayOfWeek === 6);
                const isSchoolHolidayMarker = !!SCHOOL_HOLIDAYS[dateKey]; 
                const eventData = EVENTS_BASE[dateKey] || EXAMS[dateKey]; // –¢–æ–ª—å–∫–æ –¥–ª—è —Å–æ–±—ã—Ç–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –ü–ï–†–ï–ö–†–ê–®–ò–í–ê–Æ–¢
                
                let classes = 'current-month text-gray-800'; 
                let tooltipContent = `<div class="font-bold">${day}.${monthString}.${year}</div>`;
                let label = '';
                
                // --- –®–ê–ì 1: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞ –∫–∞–Ω–∏–∫—É–ª (–ó–≤–µ–∑–¥–æ—á–∫–∞, –†–∞–º–∫–∞, –ü—É—Ä–ø—É—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç) ---
                if (isSchoolHolidayMarker) { 
                    classes = 'school-holiday'; // –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –∫–∞–Ω–∏–∫—É–ª (–±–µ–ª—ã–π —Ñ–æ–Ω + –ø—É—Ä–ø—É—Ä–Ω–∞—è —Ä–∞–º–∫–∞/—Ç–µ–∫—Å—Ç)
                    tooltipContent += `<div class="mt-1">${SCHOOL_HOLIDAYS[dateKey].name}</div>`;
                    label = '–ö–∞–Ω–∏–∫—É–ª—ã *';
                    
                    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∏–∫—É–ª –≤ —Å–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π (–µ—Å–ª–∏ –∏—Ö –Ω–µ –ø–µ—Ä–µ–∫—Ä–æ–µ—Ç –¥—Ä—É–≥–æ–µ —Å–æ–±—ã—Ç–∏–µ)
                     monthEventsList.push({ 
                        date: dateKey, name: SCHOOL_HOLIDAYS[dateKey].name, type: 'school-holiday', isNote: false 
                    });
                } else {
                     classes = 'bg-white hover:bg-gray-50';
                }

                // --- –®–ê–ì 2: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ (–ü—Ä–∞–∑–¥–Ω–∏–∫ > –ü–µ—Ä–µ–Ω–æ—Å > –í—ã—Ö–æ–¥–Ω–æ–π) ---

                // 2a. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ (Official Holiday, Transfer, Exam, Competition)
                if (eventData) {
                    let newClasses = eventData.type;
                    
                    // –ï—Å–ª–∏ —ç—Ç–æ –∫–∞–Ω–∏–∫—É–ª—ã, –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å overlay, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—É—Ä–ø—É—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç/—Ä–∞–º–∫—É
                    if (isSchoolHolidayMarker) {
                         newClasses += ' holiday-overlay';
                    }
                    classes = newClasses;
                    tooltipContent += `<div class="mt-1">${eventData.name}</div>`;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º/–æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –≤ —Å–ø–∏—Å–∫–µ (Official/Exam/Transfer events replace generic school-holiday entry)
                    monthEventsList = monthEventsList.filter(e => e.date !== dateKey || e.type !== 'school-holiday');
                    monthEventsList.push({ date: dateKey, name: eventData.name, type: eventData.type, isNote: false });

                    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–∫–∏
                    if (eventData.type === 'competition') {
                        label = (eventData.name.includes("–û–ª–∏–º–ø") || eventData.name.includes("–ù–ü–ö")) ? "–û–ª–∏–º–ø/–ù–ü–ö" : "–ö–æ–Ω–∫—É—Ä—Å";
                    } else if (eventData.type.includes('transfer')) {
                        label = eventData.type === 'transfer-day-off' ? '–ü–µ—Ä–µ–Ω. –í—ã—Ö' : '–†–∞–±–æ—á–∞—è –°–±'; 
                    } else if (eventData.type === 'exam') {
                        label = '–¶–≠'; 
                    } else if (eventData.type === 'official-holiday') { 
                         label = eventData.name.split(' ')[0]; 
                    }
                     // –ï—Å–ª–∏ —ç—Ç–æ –∫–∞–Ω–∏–∫—É–ª—ã + –ø—Ä–∞–∑–¥–Ω–∏–∫, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –º–µ—Ç–∫—É –∫–∞–Ω–∏–∫—É–ª
                    if (isSchoolHolidayMarker && !label.includes('*')) {
                        label += ' *';
                    }

                } 
                // 2b. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –í—ã—Ö–æ–¥–Ω–æ–π (–°–±/–í—Å)
                else if (isWeekend) {
                    let newClasses = 'weekend'; // –°–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω
                    
                    // –ï—Å–ª–∏ —ç—Ç–æ –∫–∞–Ω–∏–∫—É–ª—ã, –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å overlay
                    if (isSchoolHolidayMarker) {
                        newClasses += ' holiday-overlay';
                    }
                    classes = newClasses;

                    tooltipContent += `<div class="mt-1">–í—ã—Ö–æ–¥–Ω–æ–π (–°–±/–í—Å)</div>`;
                    if (isSchoolHolidayMarker) {
                         // –ï—Å–ª–∏ —ç—Ç–æ –°–±/–í—Å –∏ –ö–∞–Ω–∏–∫—É–ª—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–µ –º–µ—Ç–∫–∏
                         label = label || '–ö–∞–Ω–∏–∫—É–ª—ã *';
                    }
                }
                
                // --- 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞–º–µ—Ç–∫—É (–ù–∞–∏–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–∏–º–≤–æ–ª–∞) ---
                let noteIndicator = '';
                const noteData = userNotes[dateKey];
                if (noteData) {
                    noteIndicator = '<span class="note-indicator text-indigo-600">#</span>';
                    const noteSnippet = noteData.content.substring(0, 50).trim();
                    tooltipContent += `<div class="mt-2 pt-2 border-t border-gray-600">–ó–∞–º–µ—Ç–∫–∞ (#): <span class="font-semibold">${noteSnippet}${noteData.content.length > 50 ? '...' : ''}</span></div>`;
                    
                     monthEventsList.push({ 
                        date: dateKey, name: noteData.content, type: 'user-note', isNote: true 
                    });
                }

                // --- 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å (–í—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è) ---
                if (dateKey === TODAY_DATE_KEY) {
                    classes += ' today';
                    tooltipContent = `<div class="font-bold text-lg mb-1">–°–ï–ì–û–î–ù–Ø</div>` + tooltipContent;
                    label = label || '–°–ï–ì–û–î–ù–Ø';
                }

                calendarHtml += `
                    <div class="day-cell ${classes} relative group" 
                         data-date="${dateKey}" 
                         onclick="openNoteModal('${dateKey}')">
                        <span class="day-number">${day}</span>
                        ${noteIndicator}
                        ${label ? `<span class="text-[0.6rem] leading-none opacity-80 mt-1">${label}</span>` : ''}
                        
                        <span class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-1 px-2 py-2 bg-gray-800 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 shadow-lg tooltip-content">
                            ${tooltipContent}
                        </span>
                    </div>
                `;
            }

            // 3. –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –≤ –∫–æ–Ω—Ü–µ
            const totalCells = firstWeekday - 1 + daysInMonth;
            const remainingCells = (42 - totalCells) % 7; 

            for (let i = 0; i < remainingCells; i++) {
                calendarHtml += `<div class="day-cell other-month"></div>`;
            }

            calendarHtml += `</div>`; // –ó–∞–∫—Ä—ã–≤–∞–µ–º calendar-grid

            // 4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π (Summary List HTML)
            let summaryHtml = '';
            if (monthEventsList.length > 0) {
                 const uniqueEvents = [];
                const addedEvents = new Set();

                // –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Å–æ–±—ã—Ç–∏—è (–∫—Ä–æ–º–µ –∑–∞–º–µ—Ç–æ–∫)
                monthEventsList.filter(e => !e.isNote).forEach(event => {
                    const key = event.date + event.type;
                    if (!addedEvents.has(key)) {
                        uniqueEvents.push(event);
                        addedEvents.add(key);
                    }
                });
                
                // –ó–∞—Ç–µ–º –¥–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –∑–∞–º–µ—Ç–∫–∏
                monthEventsList.filter(e => e.isNote).forEach(note => {
                    uniqueEvents.push(note);
                });

                uniqueEvents.sort((a, b) => new Date(a.date + 'T00:00:00') - new Date(b.date + 'T00:00:00'));
                
                const consolidatedEvents = [];
                if (uniqueEvents.length > 0) {
                    let currentGroup = { ...uniqueEvents[0] };
                    let groupEnd = new Date(currentGroup.date + 'T00:00:00');
                    
                    for (let i = 1; i < uniqueEvents.length; i++) {
                        const nextItem = uniqueEvents[i];
                        const nextDate = new Date(nextItem.date + 'T00:00:00');
                        
                        if (!currentGroup.isNote && !nextItem.isNote && 
                            currentGroup.name === nextItem.name && 
                            currentGroup.type === nextItem.type &&
                            (nextDate.getTime() - groupEnd.getTime()) === (1000 * 60 * 60 * 24) 
                        ) {
                            groupEnd = nextDate; 
                        } else {
                            currentGroup.endDate = groupEnd.toLocaleDateString('en-CA');
                            consolidatedEvents.push(currentGroup);
                            
                            currentGroup = { ...nextItem };
                            groupEnd = new Date(currentGroup.date + 'T00:00:00');
                        }
                    }
                    currentGroup.endDate = groupEnd.toLocaleDateString('en-CA');
                    consolidatedEvents.push(currentGroup);
                }

                const listItems = consolidatedEvents.map(item => {
                    const startDate = new Date(item.date + 'T00:00:00');
                    const endDate = new Date(item.endDate + 'T00:00:00');
                    
                    let dateFormatted;
                    if (item.date === item.endDate) {
                        dateFormatted = startDate.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
                    } else {
                        const startDay = startDate.toLocaleDateString('ru-RU', { day: 'numeric' });
                        const endFormatted = endDate.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
                        dateFormatted = `${startDay} - ${endFormatted}`;
                    }
                    
                    let icon = '';
                    let colorClass = 'text-gray-700';
                    
                    if (item.isNote) {
                        icon = '#'; 
                        colorClass = 'text-indigo-600';
                    } else if (item.type === 'official-holiday') {
                        icon = 'üî¥';
                        colorClass = 'text-red-700 font-bold';
                    } else if (item.type === 'exam') {
                        icon = 'üìö';
                        colorClass = 'text-teal-600 font-semibold';
                    } else if (item.type.includes('transfer-workday')) {
                        icon = '‚û°Ô∏èüìÖ';
                        colorClass = 'text-blue-600 font-bold';
                    } else if (item.type.includes('transfer-day-off')) {
                        icon = '‚û°Ô∏èüõå';
                        colorClass = 'text-green-600 font-bold';
                    } else if (item.type === 'competition') {
                        icon = 'üèÜ';
                        colorClass = 'text-yellow-700';
                    } else if (item.type === 'school-holiday') {
                        icon = '‚≠ê'; 
                        colorClass = 'text-purple-600';
                    } else {
                        icon = '‚Ä¢';
                    }
                    
                    let name = item.name;
                    if(item.isNote) {
                        name = name.substring(0, 100).trim();
                        if (item.name.length > 100) name += '...';
                        colorClass += ' italic';
                    }

                    return `
                        <li class="flex items-start mb-1 leading-tight">
                            <span class="mr-2 flex-shrink-0 text-sm">${icon}</span>
                            <span class="text-xs ${colorClass}">
                                <span class="font-bold">${dateFormatted}:</span> ${name}
                            </span>
                        </li>
                    `;
                }).join('');

                summaryHtml = `
                    <div class="p-4 bg-gray-50 border-t border-gray-200">
                        <h3 class="font-bold text-sm text-gray-800 mb-2">–°–æ–±—ã—Ç–∏—è –º–µ—Å—è—Ü–∞:</h3>
                        <ul class="list-none p-0 m-0 space-y-1">
                            ${listItems}
                        </ul>
                    </div>
                `;
            }


            return `
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    ${calendarHtml}
                    ${summaryHtml}
                </div>
            `;
        }

        /**
         * –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞.
         */
        function renderCalendar() {
            const container = document.getElementById('calendarContainer');
            let current = new Date(START_DATE.getTime()); 
            let html = '';

            for (let i = 0; i < 12; i++) {
                if (current.getFullYear() > 2026 || (current.getFullYear() === 2026 && current.getMonth() > 7)) {
                    break;
                }
                
                html += generateMonthBlock(current);
                current.setMonth(current.getMonth() + 1);
            }

            container.innerHTML = html;
        }

        // üöÄ –ö–õ–Æ–ß–ï–í–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï: –°–Ω–∞—á–∞–ª–∞ —Ä–µ–Ω–¥–µ—Ä–∏–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å, –ø–æ—Ç–æ–º –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å Firebase.
        window.onload = async function() {
            // 1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
            renderCalendar(); 
            
            // 2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é Firebase –¥–ª—è –∑–∞–º–µ—Ç–æ–∫
            await initializeFirebase();
        };
    </script>
</body>
</html>
